# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `data/local`

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö **Room** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.  
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É –Ω–∏–º–∏ **–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç backend-—á–∞—Å—Ç–∏**, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–æ–º –∏ –∫–ª–∏–µ–Ω—Ç–æ–º.

---

## üóÑÔ∏è –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
- –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞
- —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫
- –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É

---

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:

- **Game**
- **Film**
- **Song**

–ö–∞–∂–¥–∞—è –∏–∑ –Ω–∏—Ö —Å–≤—è–∑–∞–Ω–∞ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –∏ –º–µ–¥–∏–∞-–¥–∞–Ω–Ω—ã—Ö.

---

## üé• –ú–µ–¥–∏–∞ –∏ –æ—Ñ–ª–∞–π–Ω-–¥–æ—Å—Ç—É–ø

–ö–∞–∂–¥–∞—è –∏–∑ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π (Game, Film, Song) –æ–±–ª–∞–¥–∞–µ—Ç –º–µ–¥–∏–∞-–¥–∞–Ω–Ω—ã–º–∏  
(–∞—É–¥–∏–æ –∏/–∏–ª–∏ –≤–∏–¥–µ–æ).

–¢–∞–∫ –∫–∞–∫ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –≤ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±—ã–ª–∞ –∑–∞–ª–æ–∂–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **–ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è**,  
–¥–ª—è –º–µ–¥–∏–∞-—Å—É—â–Ω–æ—Å—Ç–µ–π –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:

- `localVideoPath`
- `localAudioPath`

–≠—Ç–∏ –ø–æ–ª—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—É—Ç–µ–π –∫ —Ñ–∞–π–ª–∞–º, —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–º –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ,  
—á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç **–±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É**.

üìå –≠—Ç–æ **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–ª—è**, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å backend.

---

## üîó DAO –∏ —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏

–î–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –±—ã–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ **DAO**, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ –º–µ—Ç–æ–¥—ã:

- –≤—Å—Ç–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö (`insert`)
- —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (`select`)
- –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (`update`)

–î–ª—è –º–µ–¥–∏–∞-—Å—É—â–Ω–æ—Å—Ç–µ–π –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–µ—Ç–æ–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π  
–ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.

---

## üß© Relation-–º–æ–¥–µ–ª–∏

–î–ª—è —É–¥–æ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã **relation-–º–æ–¥–µ–ª–∏**,  
–∫–æ—Ç–æ—Ä—ã–µ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç —Å—É—â–Ω–æ—Å—Ç—å –∏ –≤—Å–µ –µ—ë –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

–ü—Ä–∏–º–µ—Ä—ã:
- `SongWithDetails`
- `GameWithDetails`
- `FilmWithDetails`

–¢–∞–∫–∏–µ –º–æ–¥–µ–ª–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–æ–ª—É—á–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ **–æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º**,  
–∏–∑–±–∞–≤–ª—è—è—Å—å –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é —Å–æ–±–∏—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü.

---

## üì¶ Bundles –∏ –≥—Ä—É–ø–ø–æ–≤–∞—è –≤—Å—Ç–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–¢–∞–∫ –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ —Å API –≤—Å–µ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç **—Å–ø–∏—Å–∫–∞–º–∏**,  
–≤ –ø—Ä–æ–µ–∫—Ç–µ –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ **bundle-–º–æ–¥–µ–ª–µ–π** –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø–∞–º–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π.

### –ü–æ–¥—Ö–æ–¥:
1. –î–ª—è –∫–∞–∂–¥–æ–π –æ—Å–Ω–æ–≤–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è `Bundle`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π:
    - —Å–∞–º—É —Å—É—â–Ω–æ—Å—Ç—å
    - –≤—Å–µ –µ—ë –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (translations, media, artists –∏ —Ç.–¥.)
2. –°–ø–∏—Å–æ–∫ —Ç–∞–∫–∏—Ö `Bundle` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ **–≥–ª–æ–±–∞–ª—å–Ω—ã–π bundle**
3. –ì–ª–æ–±–∞–ª—å–Ω—ã–π bundle —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–∫–∏ **–≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π**, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –ë–î

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –≤—Å—Ç–∞–≤–∫–∏
- –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—Å—Ç–∞–≤–∫–∏ —Å —É—á—ë—Ç–æ–º foreign key —Å–≤—è–∑–µ–π

---

## üß™ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```kotlin
val songsDto: List<SongDto> = ApiService.getAllSongs("ru")
val bundles = songsDto.map { it.toEntities() }

val globalBundle = bundles.toGlobalSongBundle()

db.withTransaction {
    db.artistDao().insertArtists(globalBundle.artists)
    db.artistTranslationsDao().insertArtistTranslations(globalBundle.artistTranslations)
    db.songDao().insertSongs(globalBundle.songs)
    db.songTranslationsDao().insertSongTranslations(globalBundle.songTranslations)
    db.songAudioMediaDao().insertAudioMedia(globalBundle.audioMedia)
    db.songVisualMediaDao().insertVisualMedia(globalBundle.visualMedia)
}
```

üìå –í—Å—è –≤—Å—Ç–∞–≤–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —á—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç:

- —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö  
- –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —á–∞—Å—Ç–∏—á–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π  
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É foreign key —Å–≤—è–∑–µ–π  

---

## üîÑ –ú–∞–ø–ø–∏–Ω–≥ DTO ‚Üí Entity

–î–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–æ–π –º–∞–ø–ø–∏–Ω–≥–∞.

- DTO –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ Entity  
- –ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª  
  **`DtoToEntities.kt`**  
- –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º  

–≠—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –∫–æ–¥–∞ –∏ –¥–µ–ª–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º.

---

## üèóÔ∏è –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–§–∏–Ω–∞–ª—å–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º —Å–ª–æ—è `data/local` —è–≤–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

- **`AppDatabase.kt`**

–í –Ω—ë–º:

- –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –≤—Å–µ `Entity`  
- –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ `DAO`  
- –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Room  

---

## ‚úÖ –ò—Ç–æ–≥

–°–ª–æ–π `data/local` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- –ø–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ backend-—Å—Ç—Ä—É–∫—Ç—É—Ä–µ  
- –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞  
- –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å —É—á—ë—Ç–æ–º —Å–≤—è–∑–µ–π  
- —É–¥–æ–±–Ω—É—é –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É  
- –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—é –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å–æ —Å–ø–∏—Å–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö  

–≠—Ç–æ –¥–µ–ª–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞–¥—ë–∂–Ω–æ–π –æ—Å–Ω–æ–≤–æ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –ª—é–±—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö.
